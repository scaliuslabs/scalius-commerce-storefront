---
// src/components/collection1.astro
// Grid layout collection component - receives pre-populated data from parent
import ProductCard from "@/components/cards/ProductCard.astro";
import type { CollectionWithProducts } from "@/lib/api";
import { ArrowRight } from "lucide-react";

interface Props {
  collection: CollectionWithProducts;
}

const { collection } = Astro.props;

// Data is pre-populated from consolidated API
const products = collection.products || [];
const categories = collection.categories || [];
const config = collection.config || {};

// Skip rendering if no products
if (products.length === 0) return null;

// Display settings
const title = config.title || collection.name;
const subtitle = config.subtitle || "";

// UI Logic:
// - categories.length === 1 → show "View All" link
// - categories.length > 1  → show category pills
// - categories.length === 0 → curated products, no category links
const showViewAll = categories.length === 1;
const showCategoryPills = categories.length > 1;
---

<section class="w-full py-2 md:py-6">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div
      class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2 mb-3 md:mb-5"
    >
      <div class="space-y-1">
        <h2 class="text-xl sm:text-2xl font-bold text-gray-900 tracking-tight">
          {title}
        </h2>
        {subtitle && <p class="text-gray-500 text-xs max-w-xl line-clamp-1">{subtitle}</p>}
      </div>

      <div class="flex flex-wrap items-center gap-2 sm:gap-3">
        {/* Category pills for multi-category collections */}
        {
          showCategoryPills &&
            categories.map((cat) => (
              <a
                href={`/categories/${cat.slug}`}
                class="text-sm font-medium text-gray-600 hover:text-primary px-3 py-1.5 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
              >
                {cat.name}
              </a>
            ))
        }

        {/* View All link for single category collections */}
        {
          showViewAll && (
            <a
              href={`/categories/${categories[0].slug}`}
              class="group hidden sm:inline-flex items-center gap-1.5 text-sm font-semibold text-primary hover:text-primary/80 transition-colors"
            >
              View All
              <ArrowRight className="h-4 w-4 transition-transform group-hover:translate-x-0.5" />
            </a>
          )
        }
      </div>
    </div>

    <!-- Products Grid -->
    <div
      class="grid grid-cols-2 gap-3 sm:gap-4 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"
    >
      {products.map((product) => <ProductCard product={product} />)}
    </div>

    {/* Mobile View All */}
    {
      showViewAll && (
        <div class="mt-4 flex justify-center sm:hidden">
          <a
            href={`/categories/${categories[0].slug}`}
            class="inline-flex items-center gap-2 px-6 py-2.5 text-sm font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors"
          >
            View All Products
            <ArrowRight className="h-4 w-4" />
          </a>
        </div>
      )
    }
  </div>
</section>
